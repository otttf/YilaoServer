# 测试

**注意：**在测试中，列举的是完整过程，看起来每次都会申请token，但实际上token并不需要重复申请。

## 用户注册

```
==================== REQUEST =====================
POST http://127.0.0.1:15000/v1.0/users/0/resources?appid=df3b72a07a0a4fa1854a48b543690eab

图片数据
==================== RESPONSE ====================
201 CREATED

{
    "uuid": "daaa1715-e873-4a08-b9c6-a68748917ccf"
}
====================== END =======================
```

```
==================== REQUEST =====================
GET http://127.0.0.1:15000/v1.0/users/13927553153
==================== RESPONSE ====================
404 NOT FOUND
====================== END =======================
```

```
==================== REQUEST =====================
POST http://127.0.0.1:15000/v1.0/sms

{
    "appid": "df3b72a07a0a4fa1854a48b543690eab",
    "mobile": 13927553153,
    "method": "PUT",
    "base_url": "http://127.0.0.1:15000/v1.0/users/13927553153"
}
==================== RESPONSE ====================
201 CREATED
====================== END =======================
```

```
==================== REQUEST =====================
PUT http://127.0.0.1:15000/v1.0/users/13927553153?code=1234&appid=df3b72a07a0a4fa1854a48b543690eab

{
    "passwd": "12345679",
    "nickname": "hello",
    "sex": "male",
    "id_name": "me",
    "id_school": "school",
    "id_photo": "daaa1715-e873-4a08-b9c6-a68748917ccf"
}
==================== RESPONSE ====================
201 CREATED
====================== END =======================
```

## 用户登录

### 通过密码

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "64f821c1103d44a8b1750e1fbb840fa7"
}
====================== END =======================
```

### 通过验证码

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/sms

{
    "appid": "df3b72a07a0a4fa1854a48b543690eab",
    "mobile": 13927553153,
    "method": "POST",
    "base_url": "http://127.0.0.1:5000/v1.0/users/13927553153/tokens"
}
==================== RESPONSE ====================
201 CREATED
====================== END =======================
```

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?code=1234&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "3c9d640882cd4fa48590ee9731c4c664"
}
====================== END =======================
```

## 更新用户信息

### 重要字段

#### 通过密码

```
==================== REQUEST =====================
PATCH http://127.0.0.1:5000/v1.0/users/13927553153?passwd=12345679

{
    "passwd": "12345680"
}
==================== RESPONSE ====================
204 NO CONTENT
====================== END =======================
```

#### 通过验证码

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/sms

{
    "appid": "df3b72a07a0a4fa1854a48b543690eab",
    "mobile": 13927553153,
    "method": "PATCH",
    "base_url": "http://127.0.0.1:5000/v1.0/users/13927553153"
}
==================== RESPONSE ====================
201 CREATED
====================== END =======================
```

```
==================== REQUEST =====================
PATCH http://127.0.0.1:5000/v1.0/users/13927553153?code=1234&appid=df3b72a07a0a4fa1854a48b543690eab

{
    "passwd": "12345679"
}
==================== RESPONSE ====================
204 NO CONTENT
====================== END =======================
```

### 普通字段

#### 通过token

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
PATCH http://127.0.0.1:5000/v1.0/users/13927553153?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab

{
    "default_location": {
        "longitude": 12,
        "latitude": 34,
        "name": "abc"
    }
}
==================== RESPONSE ====================
204 NO CONTENT
====================== END =======================
```

## 获取用户信息

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
GET http://127.0.0.1:5000/v1.0/users/13927553153?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
200 OK

{
    "mobile": 13927553153,
    "sex": null,
    "create_at": "2021-02-14T06:06:25",
    "nickname": null,
    "portrait": null,
    "default_location": {
        "longitude": 34.0,
        "latitude": 12.0,
        "name": "abc"
    },
    "mark": null
}
====================== END =======================
```

## 新建订单

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/orders?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab

{
    "tasks": [
        {
            "name": "abc",
            "type": "aaa",
            "count": 1,
            "reward": 1,
            "destination": {
                "longitude": 12,
                "latitude": 30,
                "name": "wwww"
            }
        }
    ]
}
==================== RESPONSE ====================
201 CREATED

{
    "id": 1
}
====================== END =======================
```

## 获取和用户相关的订单

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
GET http://127.0.0.1:5000/v1.0/users/13927553153/orders?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
200 OK

[
    {
        "emergency_level": "normal",
        "close_at": null,
        "destination": {
            "longitude": 90.0,
            "latitude": 0.0,
            "name": null
        },
        "create_at": "2021-02-14T06:06:25",
        "id": 1,
        "executor": null,
        "tasks": [
            {
                "in_at": null,
                "destination": {
                    "longitude": 30.0,
                    "latitude": 12.0,
                    "name": "wwww"
                },
                "detail": null,
                "name": "abc",
                "count": 1,
                "id": 1,
                "out_at": null,
                "reward": 1.0,
                "protected_info": null,
                "type": "aaa"
            }
        ],
        "receive_at": null,
        "from_user": 13927553153,
        "close_state": null
    }
]
====================== END =======================
```

## 获取还没被接取的订单

```
==================== REQUEST =====================
GET http://127.0.0.1:5000/v1.0/public_orders
==================== RESPONSE ====================
200 OK

[
    {
        "emergency_level": "normal",
        "close_at": null,
        "destination": {
            "longitude": 90.0,
            "latitude": 0.0,
            "name": null
        },
        "create_at": "2021-02-14T06:06:25",
        "id": 1,
        "executor": null,
        "tasks": [
            {
                "in_at": null,
                "destination": {
                    "longitude": 30.0,
                    "latitude": 12.0,
                    "name": "wwww"
                },
                "detail": null,
                "name": "abc",
                "count": 1,
                "id": 1,
                "out_at": null,
                "reward": 1.0,
                "protected_info": null,
                "type": "aaa"
            }
        ],
        "receive_at": null,
        "from_user": 13927553153,
        "close_state": null
    }
]
====================== END =======================
```

## 注册另一位用户：16698066603

## 接单/取消接单

```
==================== REQUEST =====================
POST http://127.0.0.1:15000/v1.0/users/16698066603/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "9777b8a8a9c94b778be8e048a0b67d98"
}
====================== END =======================
```

```
==================== REQUEST =====================
PATCH http://127.0.0.1:15000/v1.0/users/16698066603/orders/1?token=9777b8a8a9c94b778be8e048a0b67d98&appid=df3b72a07a0a4fa1854a48b543690eab&receive=True
==================== RESPONSE ====================
204 NO CONTENT
====================== END =======================
```

## 取消订单/完成订单

```
==================== REQUEST =====================
POST http://127.0.0.1:15000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "bcb3f8b4ce884ef59fbe3a58e8dc6d2b"
}
====================== END =======================
```

```
==================== REQUEST =====================
PATCH http://127.0.0.1:15000/v1.0/users/13927553153/orders/1?token=bcb3f8b4ce884ef59fbe3a58e8dc6d2b&appid=df3b72a07a0a4fa1854a48b543690eab&close=cancel
==================== RESPONSE ====================
204 NO CONTENT
====================== END =======================
```

## 发送信息

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/dialogs?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab

{
    "content": "hello!",
    "to_user": 16698066603
}
==================== RESPONSE ====================
201 CREATED
====================== END =======================
```

## 另一位用户回复信息：hi!

## 获取用户和另一个用户的交流

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
GET http://127.0.0.1:5000/v1.0/users/13927553153/dialogs_with/16698066603?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
200 OK

[
    {
        "to_user": 16698066603,
        "id": 1,
        "content": "hello!",
        "from_user": 13927553153,
        "send_at": "2021-02-14T06:06:25"
    },
    {
        "to_user": 13927553153,
        "id": 2,
        "content": "hi!",
        "from_user": 16698066603,
        "send_at": "2021-02-14T06:06:25"
    }
]
====================== END =======================
```

## 新建资源

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/resources?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
200 OK

{
    "uuid": "9565fc6e-14f8-4880-9e29-5a759316cf4f"
}
====================== END =======================
```

## 下载资源

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "c443bee7e5464f70b564b0cf570c75a5"
}
====================== END =======================
```

```
==================== REQUEST =====================
GET http://127.0.0.1:5000/v1.0/users/13927553153/resources/9565fc6e-14f8-4880-9e29-5a759316cf4f?token=c443bee7e5464f70b564b0cf570c75a5&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
200 OK
====================== END =======================
```

## 新建商品

```
==================== REQUEST =====================
POST http://127.0.0.1:5000/v1.0/users/13927553153/tokens?passwd=12345679&appid=df3b72a07a0a4fa1854a48b543690eab
==================== RESPONSE ====================
201 CREATED

{
    "token": "31bb3d2a2f284ea38a1cf7e472d13a1c"
}
====================== END =======================
```

```
==================== REQUEST =====================

==================== RESPONSE ====================
201 CREATED

{
    "id": 1
}
====================== END =======================
```

## 获取商品信息

```
==================== REQUEST =====================
GET http://127.0.0.1:15000/v1.0/commodities/1
==================== RESPONSE ====================
200 OK

{
    "on_offer": false,
    "photo": null,
    "sales_volume": 0.0,
    "from_user": 13927553153,
    "name": "abc1234",
    "id": 1,
    "location": {},
    "price": 123.0
}
====================== END =======================
```

